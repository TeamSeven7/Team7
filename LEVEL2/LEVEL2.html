<html>
<head>
<style>

#playerone {
  background-image:url(img/player1.png);
  width: 90px;
  height: 100px;
  position: absolute;
}

#galaxy{
  
  background-image:url(img/L2Background.jpg);
  width: 1440px;
  height: 862px;
  position: absolute;
  left: 0px;
  top: 0px;
}


#laser {
  background: #ff0000;
  width: 4px;
  height: 15px;
  position: absolute;
}
.enemy {
  background-image:url(img/eneime.png);
  width: 85px;
  height: 95px;
  position: absolute;
}
#score {
  color: #ffffff;
  font-size: 18pt;
  position: absolute;
  left: 20px;
  top: 20px;
}
#gameover {
  color: #ff0000;
  font-size: 100px;
  font-family: "Luminari";
  position: absolute;
  left: 410px;
  top: 300px;
  visibility: hidden;
}
</style>
</head>
<body>
<div id="galaxy"></div>
<div id="playerone"></div>
<div id="laser"></div>
<div id="score"></div>
<div id="gameover">GAME OVER</div>
<script>

var L_KEY = 37;
var U_KEY = 38;
var R_KEY = 39;
var D_KEY = 40;
var SPACE = 32;
var PLAYERONE_MOVEMENT = 15;

var ll = 0;
var score = 0;
var iterations = 0;

var controller = new Object();
var enemies = new Array();

function createPlayer(element, x, y, w, h) {
  var player = new Object();
  player.element = element;
  player.x = x;
  player.y = y;
  player.w = w;
  player.h = h;
  return player;
}

function toggleKeymovements(keyCode, isPressed) {
  if (keyCode == L_KEY) {
    controller.left = isPressed;
  }
  if (keyCode == R_KEY) {
    controller.right = isPressed;
  }
  if (keyCode == U_KEY) {
    controller.up = isPressed;
  }
  if (keyCode == D_KEY) {
    controller.down = isPressed;
  }
  if (keyCode == SPACE) {
    controller.space = isPressed;
  }  
}

function intersects(a, b) {
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function ensureSprite(sprite){
   if(sprite.x < 100){
    sprite.x=100;
   }
   if(sprite.y < 100){
    sprite.y=100;
   }
   if(sprite.x + sprite.w > 1200){
    sprite.x = 1200 - sprite.w;
   }
   if(sprite.y + sprite.h > 680){
    sprite.y = 680 - sprite.h;
   }

}
function setmove(sprite) {
  var e = document.getElementById(sprite.element);
  e.style.left = sprite.x + 'px';
  e.style.top = sprite.y + 'px';
}

function handleControlsmovements() {
  if (controller.up) {
    playerone.y -= PLAYERONE_MOVEMENT;
  }
  if (controller.down) {
    playerone.y += PLAYERONE_MOVEMENT;
  }
  if (controller.left) {
    playerone.x -= PLAYERONE_MOVEMENT;
  }
  if (controller.right) {
    playerone.x += PLAYERONE_MOVEMENT;
  }
  if (controller.space && laser.y <= -120) {
    laser.x =  playerone.x + 50;
    laser.y =  playerone.y - laser.h;
  }
  
  ensureSprite(playerone);
}

function checkCollisions() {
  for (var i = 0; i < enemies.length; i++) {
    if (intersects(laser, enemies[i])) {
      var element = document.getElementById(enemies[i].element);
      element.style.visibility = 'hidden';
      element.parentNode.removeChild(element);
      enemies.splice(i, 1);
      i--;
      laser.y = -laser.h;
      score += 50;
    } else if (intersects(playerone, enemies[i])) {
      gameOver();
    } else if (enemies[i].y + enemies[i].h >= 500) {
      var element = document.getElementById(enemies[i].element);
      element.style.visibility = 'hidden';
      element.parentNode.removeChild(element);
      enemies.splice(i, 1);
      i--;
    }
  }
}

function gameOver() {
  var element = document.getElementById(playerone.element);
  element.style.visibility = 'hidden';
  element = document.getElementById('gameover');
  element.style.visibility = 'visible';
}

function showplayer() {
  setmove(playerone);
  setmove(laser);
  for (var i = 0; i < enemies.length; i++) {
    setmove(enemies[i]);
  }
  var scoreElement = document.getElementById('score');
  scoreElement.innerHTML = 'SCORE: ' + score;
}

function updatePositions() {
  for (var i = 0; i < enemies.length; i++) {
    enemies[i].y += 4;
    enemies[i].x += getRandom(7) - 3;
    ensureSprite(enemies[i], true);
  }
  laser.y -= 50;
}

function addEnemy() {
  var interval = 50;
  if (iterations > 1500) {
    interval = 5;
  } else if (iterations > 1000) {
    interval = 20;
  } else if (iterations > 500) {
    interval = 35;
  }
  
  if (getRandom(interval) == 0) {
    var elementName = 'enemy' + getRandom(10000000);
    var enemy = createPlayer(elementName, getRandom(450), -40, 35, 35);
    
    var element = document.createElement('div');
    element.id = enemy.element;
    element.className = 'enemy'; 
    document.children[0].appendChild(element);
    
    enemies[enemies.length] = enemy;
  }
}

function getRandom(maxSize) {
  return parseInt(Math.random() * maxSize);
}

function loop() {
  if (new Date().getTime() - ll > 40) {
    updatePositions();
    handleControlsmovements()
    checkCollisions();
    
    addEnemy();
    
    showplayer();
    
    ll = new Date().getTime();
    iterations++;
  }
  setTimeout('loop();', 2);
}

document.onkeydown = function(evt) {
    toggleKeymovements(evt.keyCode, true);
};

document.onkeyup = function(evt) {
    toggleKeymovements(evt.keyCode, false);
};

var playerone= createPlayer('playerone', 250, 460, 20, 20);
var laser = createPlayer('laser', 0, -120, 2, 50);

loop();

</script>
</body>
</html>